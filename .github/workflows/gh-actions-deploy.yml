---

name: Deploy to AWS
on:
  push:
    branches:
      - prod

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Set up SSH key
        run: |
          mkdir -v -p ${{ runner.temp }}/.ssh
          echo "${{ secrets.AICBERLABS }}" > ${{ runner.temp }}/.ssh/aicyberlabs-sec
          chmod 600 ${{ runner.temp }}/.ssh/aicyberlabs-sec
          ssh-keyscan -H 18.216.119.33 >> ${{ runner.temp }}/.ssh/known_hosts
      - name: Deploy to EC2
        run: ssh -i ${{ runner.temp }}/.ssh/aicyberlabs-sec -o "StrictHostKeyChecking=no"
          ec2-user@18.216.119.33 'bash ~/deploy.sh'
